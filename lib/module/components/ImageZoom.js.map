{"version":3,"names":["React","useRef","useState","Image","ActivityIndicator","StyleSheet","PanGestureHandler","PinchGestureHandler","Animated","useAnimatedGestureHandler","useAnimatedStyle","useSharedValue","withTiming","clamp","noop","AnimatedImage","createAnimatedComponent","styles","create","container","flex","content","flexGrow","position","overflow","loader","absoluteFillObject","backgroundColor","ImageZoom","uri","minScale","maxScale","minPanPointers","maxPanPointers","isPanEnabled","isPinchEnabled","onLoadEnd","onInteractionStart","onInteractionEnd","onPinchStart","onPinchEnd","onPanStart","onPanEnd","style","containerStyle","imageContainerStyle","activityIndicatorProps","renderLoader","props","panRef","pinchRef","isInteracting","isPanning","isPinching","isLoading","setIsLoading","state","setState","canInteract","centerX","centerY","scale","initialFocalX","initialFocalY","focalX","focalY","translateX","translateY","onInteractionStarted","current","onInteractionEnded","onPinchStarted","onPinchEnded","onPanStarted","onPanEnded","panHandler","onActive","event","value","translationX","translationY","onFinish","pinchHandler","onStart","animatedStyle","transform","onLayout","nativeEvent","layout","x","y","width","height","onImageLoadEnd","createElement","ref","simultaneousHandlers","onGestureEvent","onActivated","onCancelled","onEnded","onFailed","enabled","View","minPointers","maxPointers","_extends","source","size","color"],"sources":["ImageZoom.tsx"],"sourcesContent":["import React, { useRef, useState } from 'react';\r\nimport { Image } from 'expo-image';\r\nimport {\r\n  ActivityIndicator,\r\n  LayoutChangeEvent,\r\n  StyleSheet,\r\n} from 'react-native';\r\nimport {\r\n  PanGestureHandler,\r\n  PanGestureHandlerEventPayload,\r\n  PanGestureHandlerGestureEvent,\r\n  PinchGestureHandler,\r\n  PinchGestureHandlerEventPayload,\r\n  PinchGestureHandlerGestureEvent,\r\n} from 'react-native-gesture-handler';\r\nimport Animated, {\r\n  useAnimatedGestureHandler,\r\n  useAnimatedStyle,\r\n  useSharedValue,\r\n  withTiming,\r\n} from 'react-native-reanimated';\r\n\r\nimport { clamp, noop } from '../helpers/index';\r\n\r\nimport type { ImageZoomProps } from './types';\r\n\r\nconst AnimatedImage = Animated.createAnimatedComponent(Image);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n  },\r\n  content: {\r\n    flex: 1,\r\n    flexGrow: 1,\r\n    position: 'relative',\r\n    overflow: 'hidden',\r\n  },\r\n  loader: {\r\n    ...StyleSheet.absoluteFillObject,\r\n    backgroundColor: 'whitesmoke',\r\n  },\r\n});\r\n\r\nexport default function ImageZoom({\r\n  uri = '',\r\n  minScale = 1,\r\n  maxScale = 5,\r\n  minPanPointers = 2,\r\n  maxPanPointers = 2,\r\n  isPanEnabled = true,\r\n  isPinchEnabled = true,\r\n  onLoadEnd = noop,\r\n  onInteractionStart = noop,\r\n  onInteractionEnd = noop,\r\n  onPinchStart = noop,\r\n  onPinchEnd = noop,\r\n  onPanStart = noop,\r\n  onPanEnd = noop,\r\n  style = {},\r\n  containerStyle = {},\r\n  imageContainerStyle = {},\r\n  activityIndicatorProps = {},\r\n  renderLoader,\r\n  ...props\r\n}: ImageZoomProps) {\r\n  const panRef = useRef();\r\n  const pinchRef = useRef();\r\n\r\n  const isInteracting = useRef(false);\r\n  const isPanning = useRef(false);\r\n  const isPinching = useRef(false);\r\n\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [state, setState] = useState({\r\n    canInteract: false,\r\n    centerX: 0,\r\n    centerY: 0,\r\n  });\r\n\r\n  const { canInteract, centerX, centerY } = state;\r\n\r\n  const scale = useSharedValue(1);\r\n  const initialFocalX = useSharedValue(0);\r\n  const initialFocalY = useSharedValue(0);\r\n  const focalX = useSharedValue(0);\r\n  const focalY = useSharedValue(0);\r\n  const translateX = useSharedValue(0);\r\n  const translateY = useSharedValue(0);\r\n\r\n  const onInteractionStarted = () => {\r\n    if (!isInteracting.current) {\r\n      isInteracting.current = true;\r\n      onInteractionStart();\r\n    }\r\n  };\r\n\r\n  const onInteractionEnded = () => {\r\n    if (isInteracting.current && !isPinching.current && !isPanning.current) {\r\n      isInteracting.current = false;\r\n      onInteractionEnd();\r\n    }\r\n  };\r\n\r\n  const onPinchStarted = () => {\r\n    onInteractionStarted();\r\n    isPinching.current = true;\r\n    onPinchStart();\r\n  };\r\n\r\n  const onPinchEnded = () => {\r\n    isPinching.current = false;\r\n    onPinchEnd();\r\n    onInteractionEnded();\r\n  };\r\n\r\n  const onPanStarted = () => {\r\n    onInteractionStarted();\r\n    isPanning.current = true;\r\n    onPanStart();\r\n  };\r\n\r\n  const onPanEnded = () => {\r\n    isPanning.current = false;\r\n    onPanEnd();\r\n    onInteractionEnded();\r\n  };\r\n\r\n  const panHandler = useAnimatedGestureHandler<PanGestureHandlerGestureEvent>({\r\n    onActive: (event: PanGestureHandlerEventPayload) => {\r\n      translateX.value = event.translationX;\r\n      translateY.value = event.translationY;\r\n    },\r\n    onFinish: () => {\r\n      translateX.value = withTiming(0);\r\n      translateY.value = withTiming(0);\r\n    },\r\n  });\r\n\r\n  const pinchHandler =\r\n    useAnimatedGestureHandler<PinchGestureHandlerGestureEvent>({\r\n      onStart: (event: PinchGestureHandlerEventPayload) => {\r\n        initialFocalX.value = event.focalX;\r\n        initialFocalY.value = event.focalY;\r\n      },\r\n      onActive: (event: PinchGestureHandlerEventPayload) => {\r\n        // onStart: focalX & focalY result both to 0 on Android\r\n        if (initialFocalX.value === 0 && initialFocalY.value === 0) {\r\n          initialFocalX.value = event.focalX;\r\n          initialFocalY.value = event.focalY;\r\n        }\r\n        scale.value = clamp(event.scale, minScale, maxScale);\r\n        focalX.value = (centerX - initialFocalX.value) * (scale.value - 1);\r\n        focalY.value = (centerY - initialFocalY.value) * (scale.value - 1);\r\n      },\r\n      onFinish: () => {\r\n        scale.value = withTiming(1);\r\n        focalX.value = withTiming(0);\r\n        focalY.value = withTiming(0);\r\n        initialFocalX.value = 0;\r\n        initialFocalY.value = 0;\r\n      },\r\n    });\r\n\r\n  const animatedStyle = useAnimatedStyle(() => ({\r\n    transform: [\r\n      { translateX: translateX.value },\r\n      { translateY: translateY.value },\r\n      { translateX: focalX.value },\r\n      { translateY: focalY.value },\r\n      { scale: scale.value },\r\n    ],\r\n  }));\r\n\r\n  const onLayout = ({\r\n    nativeEvent: {\r\n      layout: { x, y, width, height },\r\n    },\r\n  }: LayoutChangeEvent) => {\r\n    setState((current) => ({\r\n      ...current,\r\n      canInteract: true,\r\n      centerX: x + width / 2,\r\n      centerY: y + height / 2,\r\n    }));\r\n  };\r\n\r\n  const onImageLoadEnd = () => {\r\n    onLoadEnd();\r\n    setIsLoading(false);\r\n  };\r\n\r\n  return (\r\n    <PinchGestureHandler\r\n      ref={pinchRef}\r\n      simultaneousHandlers={[panRef]}\r\n      onGestureEvent={pinchHandler}\r\n      onActivated={onPinchStarted}\r\n      onCancelled={onPinchEnded}\r\n      onEnded={onPinchEnded}\r\n      onFailed={onPinchEnded}\r\n      enabled={isPinchEnabled && canInteract}\r\n    >\r\n      <Animated.View style={[styles.container, containerStyle]}>\r\n        <PanGestureHandler\r\n          ref={panRef}\r\n          simultaneousHandlers={[pinchRef]}\r\n          onGestureEvent={panHandler}\r\n          onActivated={onPanStarted}\r\n          onCancelled={onPanEnded}\r\n          onEnded={onPanEnded}\r\n          onFailed={onPanEnded}\r\n          minPointers={minPanPointers}\r\n          maxPointers={maxPanPointers}\r\n          enabled={isPanEnabled && canInteract}\r\n        >\r\n          <Animated.View\r\n            onLayout={onLayout}\r\n            style={[styles.content, imageContainerStyle]}\r\n          >\r\n            <AnimatedImage\r\n              style={[styles.container, style, animatedStyle]}\r\n              source={{ uri }}\r\n              onLoadEnd={onImageLoadEnd}\r\n              {...props}\r\n            />\r\n            {isLoading &&\r\n              (renderLoader ? (\r\n                renderLoader()\r\n              ) : (\r\n                <ActivityIndicator\r\n                  size=\"small\"\r\n                  style={styles.loader}\r\n                  color=\"dimgrey\"\r\n                  {...activityIndicatorProps}\r\n                />\r\n              ))}\r\n          </Animated.View>\r\n        </PanGestureHandler>\r\n      </Animated.View>\r\n    </PinchGestureHandler>\r\n  );\r\n}\r\n"],"mappings":"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"}